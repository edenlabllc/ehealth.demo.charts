# {{- if  ne .Values.env "prod" }}
# apiVersion: extensions/v1beta1
# kind: Deployment
# metadata:
#   name: {{ .Values.image_secondary_events_consumer.name }}
#   labels:
#     app: {{ .Values.image_secondary_events_consumer.name }}
# spec:
#   replicas: 1
#   revisionHistoryLimit: 3
#   selector:
#     matchLabels:
#       app: {{ .Values.image_secondary_events_consumer.name }}
#   strategy:
#     rollingUpdate:
#       maxSurge: {{ .Values.rollingUpdate.maxSurge }}
#       maxUnavailable: {{ .Values.rollingUpdate.maxUnavailable }}
#     type: RollingUpdate
#   template:
#     metadata:
#       labels:
#         app: {{ .Values.image_secondary_events_consumer.name }}
#     spec:
#       containers:
#       - name: {{ .Values.image_secondary_events_consumer.name }}
#         image: {{ .Values.image_secondary_events_consumer.repository }}:{{ .Values.image_secondary_events_consumer.tag }}
#         imagePullPolicy: Always
#         command: ["sh", "-c"]
#         args: ["POD_A_RECORD"]
#         args: ["export POD_A_RECORD=$(echo $POD_IP | sed 's/\\./\\-/g') && /app/bin/secondary_events_consumer foreground"]
#         ports:
#         - containerPort: 4000
#           protocol: TCP
#         env:
#         {{- range $name, $value := .Values.env_api }}
#         {{- if not (empty $value) }}
#         - name: {{ $name | quote }}
#           value: {{ $value | quote }}
#         {{- end }}
#         {{- end }}
#         # RPC env
#         - name: NAMESPACE
#           value: "{{ .Values.env_api.NAMESPACE }}"
#         - name: POD_IP
#           valueFrom:
#             fieldRef:
#               fieldPath: status.podIP
#         resources:
#           requests:
#             cpu: {{ .Values.resources_api.cpu }}
#             memory: {{ .Values.resources_api.memory }}
#           limits:
#             cpu: {{ .Values.resources_api.cpu_limit }}
#             memory: {{ .Values.resources_api.memory_limit }}
#         {{- if or (eq .Values.env "prod") (eq .Values.env "preprod") }}
#       nodeSelector:
#         cloud.google.com/gke-nodepool: {{ .Values.nodeSelector_api}}
#         {{ end }}
# {{- end }}
